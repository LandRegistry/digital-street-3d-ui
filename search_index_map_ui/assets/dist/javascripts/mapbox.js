!function(e){var r={};function t(i){if(r[i])return r[i].exports;var o=r[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(i,o,function(r){return e[r]}.bind(null,o));return i},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=4)}({4:function(e,r){mapboxgl.accessToken="pk.eyJ1IjoibWF0dGdpcmRsZXIiLCJhIjoiY2lteW85cm5lMDBmcnY5bTFxY2Zsc3c2OCJ9.VvO2DhAhOVrcjJ0Usw8JIA";var t=new mapboxgl.Map({style:"mapbox://styles/mattgirdler/cjznu3ztu06m31clp2j37yybz",center:[-3.52841649197765,50.7242226667005],zoom:16.5,pitch:45,bearing:-17.6,container:"map",antialias:!0}),i="exeter_buildings_with_height-0ygi87",o=[{layer:"princesshay-level-gf-leasehold",sourceLayer:"princesshay-level-gf-8yagcd"},{layer:"princesshay-level-gf-freehold",sourceLayer:"princesshay-level-gf-8yagcd"},{layer:"princesshay-level-1-leasehold",sourceLayer:"princesshay-level-1-90cnib"},{layer:"princesshay-level-1-freehold",sourceLayer:"princesshay-level-1-90cnib"}],a=document.getElementById("spatial-units"),n=JSON.parse(a.innerHTML);function s(e){for(var r in o){if(o[r].layer.includes(e))"visible"===t.getLayoutProperty(o[r].layer,"visibility")?(t.setLayoutProperty(o[r].layer,"visibility","none"),this.className=""):(this.className="active",t.setLayoutProperty(o[r].layer,"visibility","visible"))}}t.on("load",function(){var e=[];for(var r in o){var a=t.querySourceFeatures("composite",{sourceLayer:o[r].sourceLayer});for(var s in a)e.includes(a[s].properties.fid)||e.push(a[s].properties.fid)}var l=["in","fid"].concat(e),p=t.querySourceFeatures("composite",{sourceLayer:i,filter:l});for(var u in p)t.setFeatureState({id:p[u].id,source:"composite",sourceLayer:i},{hide:!0}),y(p[u].properties.fid);var c=document.getElementById("title-information-overlay");document.getElementById("toggle-layers-overlay").style.display="block";new mapboxgl.Popup({closeButton:!1});function y(e){for(var r in o){t.setLayoutProperty(o[r].layer,"visibility","visible");var a=t.querySourceFeatures("composite",{sourceLayer:o[r].sourceLayer,filter:["==","fid",e]});if(a.length>0){var n=a[0].properties.fid,s=t.querySourceFeatures("composite",{sourceLayer:i,filter:["==","fid",n]})[0].properties.RelHmax/a[0].properties.num_floors,l=s*(a[0].properties.floor+1),p=s*a[0].properties.floor;t.setPaintProperty(o[r].layer,"fill-extrusion-height",o[r].layer.includes("freehold")?l+1:l,{validate:!0}),t.setPaintProperty(o[r].layer,"fill-extrusion-base",p,{validate:!0})}}}t.on("click","exeter-buildings-with-height",function(e){var r=t.queryRenderedFeatures(e.point)[0];t.getFeatureState({id:r.id,source:"composite",sourceLayer:i}).hide?(!function(e){for(var r in o)t.querySourceFeatures("composite",{sourceLayer:o[r].sourceLayer,filter:["==","fid",e]}).length>0&&(t.setPaintProperty(o[r].layer,"fill-extrusion-base",0,{validate:!0}),t.setPaintProperty(o[r].layer,"fill-extrusion-height",0,{validate:!0}))}(r.properties.fid),t.removeFeatureState({id:r.id,source:"composite",sourceLayer:i},"hide")):(t.setFeatureState({id:r.id,source:"composite",sourceLayer:i},{hide:!0}),y(r.properties.fid))}),t.on("mousemove",function(e){!function(){for(var e in o)t.removeFeatureState({source:"composite",sourceLayer:o[e].sourceLayer})}();var r=[];for(var i in o)r.push(o[i].layer);var a=t.queryRenderedFeatures(e.point,{layers:r});if(a.length>0){var s=a[0];!function(e){for(var r in o){var i=t.querySourceFeatures("composite",{sourceLayer:o[r].sourceLayer,filter:["==","title_no",e]});for(var a in i)t.setFeatureState({id:i[a].id,source:"composite",sourceLayer:o[r].sourceLayer},{highlight:!0})}}(s.properties.title_no);var l=s.properties.id,p=n[0].find(function(e){return e.id==l}),u=[];if(p)for(var y in p.ba_units){var d=p.ba_units[y];console.log(d);var f={address:p.address,titleNumber:d.name,rights:[],restrictions:[],responsibilities:[]};for(var v in d.rights){var m=d.rights[v],h={rightId:m.right_id,type:m.type,description:m.description,mortgages:[]};for(var g in m.party&&(h.party={name:m.party.name,type:m.party.type,partyId:m.party}),m.mortgages){var b=m.mortgages[g],L={type:b.type,amount:b.amount,interestRate:b.interest_rate};h.mortgages.push(L)}f.rights.push(h)}for(var x in d.restrictions){var P=d.restrictions[x],S={type:P.type,description:P.description};P.party&&(S.party={name:P.party.name,type:P.party.type,partyId:P.party}),f.restrictions.push(S)}for(var F in d.responsibilities){var _=d.responsibilities[F],C={type:_.type,description:_.description};_.party&&(C.party={name:_.party.name,type:_.party.type,partyId:_.party}),f.responsibilities.push(C)}u.push(f)}c.innerHTML="";var j=document.createElement("strong");j.textContent=u[0].titleNumber,c.appendChild(j);var O=document.createElement("div");O.textContent=JSON.stringify(u[0]);var E=document.createElement("div");if(u[0].rights){var I=document.createElement("strong");for(right in I.textContext="Rights:",E.appendChild(I),u[0].rights){var q=document.createElement("strong");q.textContext="Type:",E.appendChild(q);var M=document.createElement("span");M.textContent=u[0].rights[right].type,E.appendChild(M)}c.appendChild(E)}c.appendChild(O),c.style.display="block"}})});for(var l=document.getElementsByName("filter"),p=0;p<l.length;p++)l[p].addEventListener("change",function(e){var r=e.target.value;e.preventDefault(),e.stopPropagation(),s(r)})}});
//# sourceMappingURL=mapbox.js.map