!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}({4:function(e,t){mapboxgl.accessToken="pk.eyJ1IjoibWF0dGdpcmRsZXIiLCJhIjoiY2lteW85cm5lMDBmcnY5bTFxY2Zsc3c2OCJ9.VvO2DhAhOVrcjJ0Usw8JIA";var r=new mapboxgl.Map({style:"mapbox://styles/mattgirdler/cjznu3ztu06m31clp2j37yybz",center:[-3.52841649197765,50.7242226667005],zoom:16.5,pitch:45,bearing:-17.6,container:"map",antialias:!0}),n="exeter_buildings_with_height-0ygi87",i=[{layer:"princesshay-level-gf-leasehold",sourceLayer:"princesshay-level-gf-8yagcd"},{layer:"princesshay-level-gf-freehold",sourceLayer:"princesshay-level-gf-8yagcd"},{layer:"princesshay-level-1-leasehold",sourceLayer:"princesshay-level-1-90cnib"},{layer:"princesshay-level-1-freehold",sourceLayer:"princesshay-level-1-90cnib"}],a=document.getElementById("spatial-units"),o=JSON.parse(a.innerHTML);function s(e){for(var t in i){if(i[t].layer.includes(e))"visible"===r.getLayoutProperty(i[t].layer,"visibility")?(r.setLayoutProperty(i[t].layer,"visibility","none"),this.className=""):(this.className="active",r.setLayoutProperty(i[t].layer,"visibility","visible"))}}r.on("load",function(){var e=[];for(var t in i){var a=r.querySourceFeatures("composite",{sourceLayer:i[t].sourceLayer});for(var s in a)e.includes(a[s].properties.fid)||e.push(a[s].properties.fid)}var p=["in","fid"].concat(e),l=r.querySourceFeatures("composite",{sourceLayer:n,filter:p});for(var d in l)r.setFeatureState({id:l[d].id,source:"composite",sourceLayer:n},{hide:!0}),u(l[d].properties.fid);var c=document.getElementById("title-information-overlay");document.getElementById("toggle-layers-overlay").style.display="block";new mapboxgl.Popup({closeButton:!1});function u(e){for(var t in i){r.setLayoutProperty(i[t].layer,"visibility","visible");var a=r.querySourceFeatures("composite",{sourceLayer:i[t].sourceLayer,filter:["==","fid",e]});if(a.length>0){var o=a[0].properties.fid,s=r.querySourceFeatures("composite",{sourceLayer:n,filter:["==","fid",o]})[0].properties.RelHmax/a[0].properties.num_floors,p=s*(a[0].properties.floor+1),l=s*a[0].properties.floor;r.setPaintProperty(i[t].layer,"fill-extrusion-height",i[t].layer.includes("freehold")?p+1:p,{validate:!0}),r.setPaintProperty(i[t].layer,"fill-extrusion-base",l,{validate:!0})}}}r.on("click","exeter-buildings-with-height",function(e){var t=r.queryRenderedFeatures(e.point)[0];r.getFeatureState({id:t.id,source:"composite",sourceLayer:n}).hide?(!function(e){for(var t in i)r.querySourceFeatures("composite",{sourceLayer:i[t].sourceLayer,filter:["==","fid",e]}).length>0&&(r.setPaintProperty(i[t].layer,"fill-extrusion-base",0,{validate:!0}),r.setPaintProperty(i[t].layer,"fill-extrusion-height",0,{validate:!0}))}(t.properties.fid),r.removeFeatureState({id:t.id,source:"composite",sourceLayer:n},"hide")):(r.setFeatureState({id:t.id,source:"composite",sourceLayer:n},{hide:!0}),u(t.properties.fid))}),r.on("mousemove",function(e){!function(){for(var e in i)c.style.display="none",r.removeFeatureState({source:"composite",sourceLayer:i[e].sourceLayer})}();var t=[];for(var n in i)t.push(i[n].layer);var a=r.queryRenderedFeatures(e.point,{layers:t});if(a.length>0){var s=a[0];!function(e){for(var t in i){var n=r.querySourceFeatures("composite",{sourceLayer:i[t].sourceLayer,filter:["==","title_no",e]});for(var a in n)r.setFeatureState({id:n[a].id,source:"composite",sourceLayer:i[t].sourceLayer},{highlight:!0})}}(s.properties.title_no);var p=s.properties.id,l=o[0].find(function(e){return e.id==p}),d=[];if(l)for(var u in l.ba_units){var m=l.ba_units[u];console.log(m);var y={address:l.address,titleNumber:m.name,rights:[],restrictions:[],responsibilities:[]};for(var h in m.rights){var v=m.rights[h],f={rightId:v.right_id,type:v.type,description:v.description,mortgages:[]};for(var g in v.party&&(f.party={name:v.party.name,type:v.party.type,partyId:v.party}),v.mortgages){var C=v.mortgages[g],b={type:C.type,amount:C.amount,interestRate:C.interest_rate};f.mortgages.push(b)}y.rights.push(f)}for(var E in m.restrictions){var x=m.restrictions[E],L={type:x.type,description:x.description};x.party&&(L.party={name:x.party.name,type:x.party.type,partyId:x.party}),y.restrictions.push(L)}for(var P in m.responsibilities){var S=m.responsibilities[P],F={type:S.type,description:S.description};S.party&&(F.party={name:S.party.name,type:S.party.type,partyId:S.party}),y.responsibilities.push(F)}d.push(y)}c.innerHTML="";var _=document.createElement("strong");_.textContent=d[0].titleNumber,c.appendChild(_),c.appendChild(document.createElement("hr"));var j=document.createElement("div");if(d[0].rights.length>0){var T=document.createElement("strong");for(right in T.textContent="Rights:",j.appendChild(T),d[0].rights){var I=document.createElement("div");I.style="margin-left: 10px;";var O=document.createElement("strong");O.textContent="Type: ",I.appendChild(O);var N=document.createElement("span");if(N.textContent=d[0].rights[right].type,I.appendChild(N),I.appendChild(document.createElement("br")),d[0].rights[right].description){var q=document.createElement("strong");q.textContent="Description: ",I.appendChild(q);var M=document.createElement("span");M.textContent=d[0].rights[right].description,I.appendChild(M),I.appendChild(document.createElement("br"))}var R=document.createElement("strong");R.textContent="Party: ",I.appendChild(R);var w=document.createElement("div");w.style="margin-left: 10px;";var B=document.createElement("strong");B.textContent="Name: ",w.appendChild(B);var D=document.createElement("span");D.textContent=d[0].rights[right].party.name,w.appendChild(D),w.appendChild(document.createElement("br"));var J=document.createElement("strong");J.textContent="Type: ",w.appendChild(J);var k=document.createElement("span");k.textContent=d[0].rights[right].party.type,w.appendChild(k),w.appendChild(document.createElement("br")),I.appendChild(w),I.appendChild(document.createElement("hr")),j.appendChild(I)}c.appendChild(j)}var z=document.createElement("div");if(d[0].restrictions.length>0){var H=document.createElement("strong");for(restriction in H.textContent="Restrictions:",z.appendChild(H),d[0].restrictions){var Y=document.createElement("div");Y.style="margin-left: 10px;";var A=document.createElement("strong");A.textContent="Type: ",Y.appendChild(A);var V=document.createElement("span");if(V.textContent=d[0].restrictions[restriction].type,Y.appendChild(V),Y.appendChild(document.createElement("br")),d[0].restrictions[restriction].description){var W=document.createElement("strong");W.textContent="Description: ",Y.appendChild(W);var Z=document.createElement("span");Z.textContent=d[0].restrictions[restriction].description,Y.appendChild(Z),Y.appendChild(document.createElement("br"))}var G=document.createElement("strong");G.textContent="Party: ",Y.appendChild(G);var U=document.createElement("div");U.style="margin-left: 10px;";var X=document.createElement("strong");X.textContent="Name: ",U.appendChild(X);var K=document.createElement("span");K.textContent=d[0].restrictions[restriction].party.name,U.appendChild(K),U.appendChild(document.createElement("br"));var Q=document.createElement("strong");Q.textContent="Type: ",U.appendChild(Q);var $=document.createElement("span");$.textContent=d[0].restrictions[restriction].party.type,U.appendChild($),U.appendChild(document.createElement("br")),Y.appendChild(U),Y.appendChild(document.createElement("hr")),z.appendChild(Y)}c.appendChild(z)}var ee=document.createElement("div");if(d[0].responsibilities.length>0){var te=document.createElement("strong");for(responsibility in te.textContent="Responsibilities:",ee.appendChild(te),d[0].responsibilities){var re=document.createElement("div");re.style="margin-left: 10px;";var ne=document.createElement("strong");ne.textContent="Type: ",re.appendChild(ne);var ie=document.createElement("span");if(ie.textContent=d[0].responsibilities[responsibility].type,re.appendChild(ie),re.appendChild(document.createElement("br")),d[0].responsibilities[responsibility].description){var ae=document.createElement("strong");ae.textContent="Description: ",re.appendChild(ae);var oe=document.createElement("span");oe.textContent=d[0].responsibilities[responsibility].description,re.appendChild(oe),re.appendChild(document.createElement("br"))}var se=document.createElement("strong");se.textContent="Party: ",re.appendChild(se);var pe=document.createElement("div");pe.style="margin-left: 10px;";var le=document.createElement("strong");le.textContent="Name: ",pe.appendChild(le);var de=document.createElement("span");de.textContent=d[0].responsibilities[responsibility].party.name,pe.appendChild(de),pe.appendChild(document.createElement("br"));var ce=document.createElement("strong");ce.textContent="Type: ",pe.appendChild(ce);var ue=document.createElement("span");ue.textContent=d[0].responsibilities[responsibility].party.type,pe.appendChild(ue),pe.appendChild(document.createElement("br")),re.appendChild(pe),re.appendChild(document.createElement("hr")),ee.appendChild(re)}c.appendChild(ee)}c.style.display="block"}})});for(var p=document.getElementsByName("filter"),l=0;l<p.length;l++)p[l].addEventListener("change",function(e){var t=e.target.value;e.preventDefault(),e.stopPropagation(),s(t)})}});
//# sourceMappingURL=mapbox.js.map