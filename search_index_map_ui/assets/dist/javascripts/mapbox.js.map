{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./search_index_map_ui/assets/src/javascripts/mapbox.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","mapboxgl","accessToken","map","Map","style","center","zoom","pitch","bearing","container","antialias","buildingHeightSourceLayer","floorplanLayers","layer","sourceLayer","spatialUnitsDiv","document","getElementById","spatialUnits","JSON","parse","innerHTML","toggleLayers","filter","includes","getLayoutProperty","setLayoutProperty","this","className","on","buildingIdsWithFloorplans","features","querySourceFeatures","j","properties","fid","push","buildingFilter","concat","buildingFeatures","setFeatureState","id","source","hide","displayFloorplan","titleInformationOverlay","display","Popup","closeButton","buildingId","length","floorHeight","RelHmax","num_floors","extrusionHeight","floor","baseHeight","setPaintProperty","validate","e","feature","queryRenderedFeatures","point","getFeatureState","hideFloorplan","removeFeatureState","disableHighlightTitle","layers","currentFeature","titleNo","highlight","highlightTitle","title_no","featureId","spatialUnit","find","element","BAUnits","BAUnit","currentBAUnit","console","log","title","address","titleNumber","rights","restrictions","responsibilities","right","currentRight","newRight","rightId","type","description","mortgages","mortgage","partyId","currentMortgage","newMortgage","amount","interestRate","restriction","currentRestriction","newRestriction","responsibility","currentResponsibility","newResponsibility","createElement","textContent","appendChild","titleData","stringify","rightsDiv","rightsLabel","textContext","rightTypeLabel","rightTypeText","filterCheckboxes","getElementsByName","addEventListener","target","preventDefault","stopPropagation"],"mappings":"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","file":"mapbox.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","\n    mapboxgl.accessToken = 'pk.eyJ1IjoibWF0dGdpcmRsZXIiLCJhIjoiY2lteW85cm5lMDBmcnY5bTFxY2Zsc3c2OCJ9.VvO2DhAhOVrcjJ0Usw8JIA'\n        let map = new mapboxgl.Map({\n        style: 'mapbox://styles/mattgirdler/cjznu3ztu06m31clp2j37yybz',\n        center: [-3.52841649197765, 50.7242226667005],\n        zoom: 16.5,\n        pitch: 45,\n        bearing: -17.6,\n        container: 'map',\n        antialias: true\n    })\n\n    const buildingHeightSourceLayer = \"exeter_buildings_with_height-0ygi87\"\n    const floorplanLayers = [\n        {layer: 'princesshay-level-gf-leasehold', sourceLayer: 'princesshay-level-gf-8yagcd'},\n        {layer: 'princesshay-level-gf-freehold', sourceLayer: 'princesshay-level-gf-8yagcd'},\n        {layer: 'princesshay-level-1-leasehold', sourceLayer: 'princesshay-level-1-90cnib'},\n        {layer: 'princesshay-level-1-freehold', sourceLayer: 'princesshay-level-1-90cnib'}\n    ]\n\n    const spatialUnitsDiv = document.getElementById('spatial-units')\n    const spatialUnits = JSON.parse(spatialUnitsDiv.innerHTML)\n\n    map.on('load', function() {\n\n        // Create array of building IDs with boundary/floorplan data\n        const buildingIdsWithFloorplans = []\n        for (let i in floorplanLayers) {\n            const features = map.querySourceFeatures('composite', {\n                sourceLayer: floorplanLayers[i].sourceLayer,\n            })\n            for (let j in features) {\n                if (!buildingIdsWithFloorplans.includes(features[j].properties.fid)) {\n                    buildingIdsWithFloorplans.push(features[j].properties.fid)\n                }\n            }\n        }\n\n        // Hide any buildings that have boundary/floorplan data \n        let buildingFilter = [\"in\", \"fid\"].concat(buildingIdsWithFloorplans)\n        const buildingFeatures = map.querySourceFeatures('composite', {\n            sourceLayer: buildingHeightSourceLayer,\n            filter: buildingFilter\n        })\n\n        for (let i in buildingFeatures) {\n            map.setFeatureState({id: buildingFeatures[i].id, source: 'composite', sourceLayer: buildingHeightSourceLayer}, {'hide': true})\n            displayFloorplan(buildingFeatures[i].properties.fid)\n        }\n\n        // Create an overlay\n        let titleInformationOverlay = document.getElementById('title-information-overlay')\n        let toggleLayersOverlay = document.getElementById('toggle-layers-overlay')\n        toggleLayersOverlay.style.display = 'block'\n        // Create a popup, but don't add it to the map yet.\n        let popup = new mapboxgl.Popup({\n            closeButton: false\n        })\n\n        // Display interior floorplans after hiding external geometry\n        function displayFloorplan(buildingId) {\n            for (let i in floorplanLayers) {\n                map.setLayoutProperty(floorplanLayers[i].layer, 'visibility', 'visible')\n                const features = map.querySourceFeatures('composite', {\n                    sourceLayer: floorplanLayers[i].sourceLayer, \n                    filter: [\"==\", 'fid', buildingId]\n                })\n                if (features.length > 0) {\n                    const buildingId = features[0].properties.fid\n                    const buildingFeature = map.querySourceFeatures('composite', {\n                        sourceLayer: buildingHeightSourceLayer,\n                        filter: [\"==\", 'fid', buildingId]\n                    })[0]\n                    const buildingHeight = buildingFeature.properties.RelHmax\n                    const floorHeight = buildingHeight / features[0].properties.num_floors\n                    const extrusionHeight = floorHeight * (features[0].properties.floor + 1)\n                    const baseHeight = floorHeight*features[0].properties.floor\n\n                    // Add +1 to freehold heights to avoid clipping effect with containing leaseholds \n                    map.setPaintProperty(floorplanLayers[i].layer, 'fill-extrusion-height', (floorplanLayers[i].layer.includes('freehold') ? extrusionHeight+1 : extrusionHeight), {validate: true})\n                    map.setPaintProperty(floorplanLayers[i].layer, 'fill-extrusion-base', baseHeight, {validate: true})\n                }\n            }\n        }\n\n        function hideFloorplan(buildingId) {\n            for (let i in floorplanLayers) {\n                const features = map.querySourceFeatures('composite', {\n                    sourceLayer: floorplanLayers[i].sourceLayer, \n                    filter: [\"==\", 'fid', buildingId]\n                })\n                if (features.length > 0) {\n                    map.setPaintProperty(floorplanLayers[i].layer, 'fill-extrusion-base', 0, {validate: true})\n                    map.setPaintProperty(floorplanLayers[i].layer, 'fill-extrusion-height', 0, {validate: true})\n                }\n            }\n        }\n\n        function highlightTitle(titleNo) {\n            for (let i in floorplanLayers) {\n                const features = map.querySourceFeatures('composite', { \n                    sourceLayer: floorplanLayers[i].sourceLayer,\n                    filter: ['==', 'title_no', titleNo ] \n                })\n                for (let j in features) {\n                    map.setFeatureState({id: features[j].id, source: 'composite', sourceLayer: floorplanLayers[i].sourceLayer}, {'highlight': true})\n                }\n            }\n        }\n\n        function disableHighlightTitle() {\n            for (let i in floorplanLayers) {\n                map.removeFeatureState({source: 'composite', sourceLayer: floorplanLayers[i].sourceLayer})\n            }\n        }\n\n        // Toggle building polygons on/off\n        map.on('click', 'exeter-buildings-with-height', function (e) {\n            const features = map.queryRenderedFeatures(e.point)\n            const feature = features[0]\n            if (map.getFeatureState({id: feature.id, source: 'composite', sourceLayer: buildingHeightSourceLayer}).hide) {\n                hideFloorplan(feature.properties.fid)\n                map.removeFeatureState({id: feature.id, source: 'composite', sourceLayer: buildingHeightSourceLayer}, 'hide')\n            } else {\n                map.setFeatureState({id: feature.id, source: 'composite', sourceLayer: buildingHeightSourceLayer}, {'hide': true})\n                displayFloorplan(feature.properties.fid)\n            }\n        })\n\n        // Display title information from floorplans\n        map.on('mousemove', function(e) {\n\n            disableHighlightTitle()\n\n            // Create array of floorplan style layers for filtering\n            const layers = []\n            for (let i in floorplanLayers) {\n                layers.push(floorplanLayers[i].layer)\n            }\n\n            // Check if mouseover is on a floorplan layer\n            const features = map.queryRenderedFeatures(e.point, { layers: layers })\n            if (features.length > 0) {\n                const currentFeature = features[0]\n\n                highlightTitle(currentFeature.properties.title_no)\n                \n                // New properties code\n                let featureId = currentFeature.properties.id\n\n                let spatialUnit = spatialUnits[0].find(function(element) {\n                    return element.id == featureId\n                })\n\n                let BAUnits = []\n\n                if (spatialUnit) {\n                    \n                    for (let BAUnit in spatialUnit['ba_units']) {\n                        let currentBAUnit = spatialUnit['ba_units'][BAUnit]\n                        console.log(currentBAUnit)\n                        let title = { \n                            address: spatialUnit.address,\n                            titleNumber: currentBAUnit['name'],\n                            rights: [],\n                            restrictions: [],\n                            responsibilities: []\n                        }\n\n                        // Rights\n                        for (let right in currentBAUnit['rights']) {\n                            let currentRight = currentBAUnit['rights'][right]\n                            let newRight = {\n                            rightId: currentRight['right_id'],\n                            type: currentRight['type'],\n                            description: currentRight['description'],\n                            mortgages: []\n                            }\n\n                            if (currentRight['party']) {\n                            newRight['party'] = {\n                                name: currentRight['party']['name'],\n                                type: currentRight['party']['type'],\n                                partyId: currentRight['party']\n                            }\n                            }\n\n                            for (let mortgage in currentRight['mortgages']) {\n                            let currentMortgage = currentRight['mortgages'][mortgage]\n                            let newMortgage = {\n                                type: currentMortgage['type'],\n                                amount: currentMortgage['amount'],\n                                interestRate: currentMortgage['interest_rate']\n                            }\n                            newRight['mortgages'].push(newMortgage)\n                            } \n                            title['rights'].push(newRight)\n                        }\n\n                        // Add restrictions\n                        for (let restriction in currentBAUnit['restrictions']) {\n                            let currentRestriction = currentBAUnit['restrictions'][restriction]\n                            let newRestriction = {\n                            type: currentRestriction['type'],\n                            description: currentRestriction['description']\n                            }\n\n                            if (currentRestriction['party']) {\n                            newRestriction['party'] = {\n                                name: currentRestriction['party']['name'],\n                                type: currentRestriction['party']['type'],\n                                partyId: currentRestriction['party']\n                            }\n                            }\n                            title['restrictions'].push(newRestriction)\n                        }\n\n                        // Add responsibilities\n                        for (let responsibility in currentBAUnit['responsibilities']) {\n                            let currentResponsibility = currentBAUnit['responsibilities'][responsibility]\n                            let newResponsibility = {\n                            type: currentResponsibility['type'],\n                            description: currentResponsibility['description']\n                            }\n\n                            if (currentResponsibility['party']) {\n                            newResponsibility['party'] = {\n                                name: currentResponsibility['party']['name'],\n                                type: currentResponsibility['party']['type'],\n                                partyId: currentResponsibility['party']\n                            }\n                            }\n                            title['responsibilities'].push(newResponsibility)\n                        }\n                        BAUnits.push(title)\n                    }\n                } \n                // else {\n                    \n                // }\n    \n                // Create HTML for title details \n                titleInformationOverlay.innerHTML = ''\n\n                // Title number\n                // let titleNumber = document.createElement('strong')\n                // titleNumber.textContent = currentFeature.properties.title_no\n\n                // // Tenure\n                // let tenureDiv = document.createElement('div')\n                // let tenureLabel = document.createElement('strong')\n                // tenureLabel.textContent = 'Tenure: '\n                // let tenureText = document.createElement('span')\n                // tenureText.textContent = currentFeature.properties.tenure\n                // tenureDiv.appendChild(tenureLabel)\n                // tenureDiv.appendChild(tenureText)\n\n                // // Address\n                // let addressDiv = document.createElement('div')\n                // let address = document.createElement('strong')\n                // address.textContent = currentFeature.properties.address\n\n\n                // // Price paid\n                // let pricePaidDiv = document.createElement('div')\n                // let pricePaidLabel = document.createElement('strong')\n                // pricePaidLabel.textContent = 'Price paid: '\n                // let pricePaidText = document.createElement('span')\n                // pricePaidText.textContent = currentFeature.properties.price_paid\n                // pricePaidDiv.appendChild(pricePaidLabel)\n                // pricePaidDiv.appendChild(pricePaidText)\n\n                // // Proprietor\n                // let proprietorDiv = document.createElement('div')\n                // let proprietorLabel = document.createElement('strong')\n                // proprietorLabel.textContent = 'Proprietor: '\n                // let proprietorText = document.createElement('span')\n                // proprietorText.textContent = currentFeature.properties.proprietor\n                // proprietorDiv.appendChild(proprietorLabel)\n                // proprietorDiv.appendChild(proprietorText)\n                \n                // titleInformationOverlay.appendChild(tenureDiv)\n                // titleInformationOverlay.appendChild(pricePaidDiv)\n                // titleInformationOverlay.appendChild(proprietorDiv)\n                \n                // New code\n                // titleInformationOverlay.innerHTML = JSON.stringify(spatialUnit)\n                let titleNumber = document.createElement('strong')\n                titleNumber.textContent = BAUnits[0]['titleNumber']\n                titleInformationOverlay.appendChild(titleNumber)\n\n                let titleData = document.createElement('div')\n                titleData.textContent = JSON.stringify(BAUnits[0])\n\n                let rightsDiv = document.createElement('div')\n                if (BAUnits[0]['rights']) {\n                    let rightsLabel = document.createElement('strong')\n                    rightsLabel.textContext = 'Rights:'\n                    rightsDiv.appendChild(rightsLabel)\n                    for (right in BAUnits[0]['rights']) {\n                        let rightTypeLabel  = document.createElement('strong')\n                        rightTypeLabel.textContext = 'Type:'\n                        rightsDiv.appendChild(rightTypeLabel)\n\n                        let rightTypeText = document.createElement('span')\n                        rightTypeText.textContent = BAUnits[0]['rights'][right]['type']\n                        rightsDiv.appendChild(rightTypeText)\n                    }\n                    titleInformationOverlay.appendChild(rightsDiv)\n                }\n\n                titleInformationOverlay.appendChild(titleData)\n                titleInformationOverlay.style.display = 'block'\n\n\n            }\n        })\n    })\n\n    function toggleLayers(filter) {\n        for (let i in floorplanLayers) {\n        if (floorplanLayers[i].layer.includes(filter)) {\n            let visibility = map.getLayoutProperty(floorplanLayers[i].layer, 'visibility')\n\n            if (visibility === 'visible') {\n            map.setLayoutProperty(floorplanLayers[i].layer, 'visibility', 'none')\n            this.className = ''\n            } else {  \n            this.className = 'active'\n            map.setLayoutProperty(floorplanLayers[i].layer, 'visibility', 'visible')\n            }\n        }\n        }\n    }\n    \n    let filterCheckboxes = document.getElementsByName('filter')\n    for (let i = 0; i<filterCheckboxes.length; i++) {\n        filterCheckboxes[i].addEventListener('change', function(e) {\n        let filter = e.target.value\n        e.preventDefault()\n        e.stopPropagation()\n        \n        toggleLayers(filter)  \n        })\n    }\n\n\n"],"sourceRoot":""}