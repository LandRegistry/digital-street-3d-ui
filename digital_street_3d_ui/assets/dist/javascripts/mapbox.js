!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}({5:function(e,t){mapboxgl.accessToken="pk.eyJ1IjoibWF0dGdpcmRsZXIiLCJhIjoiY2lteW85cm5lMDBmcnY5bTFxY2Zsc3c2OCJ9.VvO2DhAhOVrcjJ0Usw8JIA";var r=new mapboxgl.Map({style:"mapbox://styles/mattgirdler/ck34ln49b424e1cm78reaz1vs",center:[-3.5208657,50.7227184],zoom:17.5,pitch:45,bearing:-17.6,container:"map",antialias:!0}),n="exeter_buildings_with_height-0ygi87",a=[{layer:"airspace-leasehold-a6g827",sourceLayer:"airspace-a6g827"},{layer:"freehold-osgb1000012317615",sourceLayer:"osgb1000012317615-7r44n6"},{layer:"leasehold-0-osgb1000012317615",sourceLayer:"osgb1000012317615-7r44n6"},{layer:"leasehold-1-osgb1000012317615",sourceLayer:"osgb1000012317615-7r44n6"},{layer:"leasehold-2-osgb1000012317615",sourceLayer:"osgb1000012317615-7r44n6"},{layer:"leasehold-3-osgb1000012317615",sourceLayer:"osgb1000012317615-7r44n6"},{layer:"freehold-osgb1000012316884",sourceLayer:"osgb1000012316884-7dl2di"},{layer:"leasehold-0-osgb1000012316884",sourceLayer:"osgb1000012316884-7dl2di"},{layer:"leasehold-1-osgb1000012316884",sourceLayer:"osgb1000012316884-7dl2di"},{layer:"leasehold-2-osgb1000012316884",sourceLayer:"osgb1000012316884-7dl2di"},{layer:"leasehold-3-osgb1000012316884",sourceLayer:"osgb1000012316884-7dl2di"},{layer:"leasehold-4-osgb1000012316884",sourceLayer:"osgb1000012316884-7dl2di"},{layer:"leasehold-5-osgb1000012316884",sourceLayer:"osgb1000012316884-7dl2di"},{layer:"leasehold-6-osgb1000012316884",sourceLayer:"osgb1000012316884-7dl2di"},{layer:"leasehold-7-osgb1000012316884",sourceLayer:"osgb1000012316884-7dl2di"},{layer:"freehold-osgb1000012316876",sourceLayer:"osgb1000012316876-14s2hz"}],i=document.getElementById("spatial-units"),o=JSON.parse(i.innerHTML)[0];function s(e){for(var t in a){if(a[t].layer.includes(e))"visible"==r.getLayoutProperty(a[t].layer,"visibility")?(r.setLayoutProperty(a[t].layer,"visibility","none"),this.className=""):(this.className="active",r.setLayoutProperty(a[t].layer,"visibility","visible"))}}r.on("load",function(){var e=[];for(var t in a)if(!a[t].layer.includes("airspace")){var i=r.querySourceFeatures("composite",{sourceLayer:a[t].sourceLayer});for(var s in i)e.includes(i[s].properties.fid)||e.push(i[s].properties.fid)}var d=["in","fid"].concat(e),l=r.querySourceFeatures("composite",{sourceLayer:n,filter:d});for(var p in l)r.setFeatureState({id:l[p].id,source:"composite",sourceLayer:n},{hide:!0}),u(l[p].properties.fid);var c=document.getElementById("title-information-overlay");function u(e){for(var t in a)if(r.setLayoutProperty(a[t].layer,"visibility","visible"),!a[t].layer.includes("airspace")){var i=r.queryRenderedFeatures(options={layers:[a[t].layer]});for(var o in i){var s=0,d=0;if(a[t].layer.includes("freehold"))d=120;else{var l=i[o].properties.fid,p=r.querySourceFeatures("composite",{sourceLayer:n,filter:["==","fid",l]})[0].properties.RelHmax;console.log(a[t].layer),console.log("Building height ",p);var c=parseInt(i[o].properties.floor);console.log("Floor properties ",i[o].properties);var u=p/i[o].properties.num_floors;console.log("Floor height ",u),d=u*c,console.log("Extrusion height ",d),s=u*(c-1),console.log("Base height ",s)}r.setPaintProperty(a[t].layer,"fill-extrusion-height",d,{validate:!0}),r.setPaintProperty(a[t].layer,"fill-extrusion-base",s,{validate:!0})}}}function y(e){var t=function(e){var t=[];for(var r in o)o[r].ba_units[0].name==e&&t.push(o[r].id);return t}(m(e).ba_units[0].name);for(var n in a)for(var i in t){var s=r.queryRenderedFeatures(options={layers:[a[n].layer],filter:["==","id",t[i]]});for(var d in s)r.setFeatureState({id:s[d].id,source:"composite",sourceLayer:a[n].sourceLayer},{highlight:!0})}}function m(e){return o.find(function(t){return t.id==e})}document.getElementById("toggle-layers-overlay").style.display="block",r.on("mousemove",function(e){var t=[];for(var n in a)t.push(a[n].layer);var i=r.queryRenderedFeatures(e.point,{layers:t});if(i.length>0){!function(){for(var e in a)c.style.display="none",r.removeFeatureState({source:"composite",sourceLayer:a[e].sourceLayer})}();var o=i[0];y(o.properties.id);var s=m(o.properties.id),d=[];if(s)for(var l in s.ba_units){var p=s.ba_units[l],u={address:s.address,titleNumber:p.name,pricePaid:[],rights:[],restrictions:[],responsibilities:[]};for(var h in s.price_paid){var g=s.price_paid[h];u.pricePaid.push({amount:g.amount,date:g.date})}for(var v in p.rights){var f=p.rights[v],b={rightId:f.right_id,type:f.type,description:f.description,mortgages:[],startDate:f.start_date,endDate:f.end_date};f.party&&(b.party={name:f.party.name,type:f.party.type,partyId:f.party}),u.rights.push(b)}for(var C in p.restrictions){var E=p.restrictions[C],x={type:E.type,description:E.description,startDate:E.start_date,endDate:E.end_date};E.party&&(x.party={name:E.party.name,type:E.party.type,partyId:E.party}),u.restrictions.push(x)}for(var L in p.responsibilities){var P=p.responsibilities[L],_={type:P.type,description:P.description,startDate:P.start_date,endDate:P.end_date};P.party&&(_.party={name:P.party.name,type:P.party.type,partyId:P.party}),u.responsibilities.push(_)}d.push(u)}c.innerHTML="";var D=document.createElement("h1");D.textContent=d[0].rights[0].type,c.appendChild(D);var F=document.createElement("strong");F.textContent="Title number: ",c.append(F);var I=document.createElement("span");if(I.append(d[0].titleNumber),c.appendChild(I),d[0].address){var S=document.createElement("div"),O=document.createElement("strong");O.textContent="Address: ",S.append(O);var j=document.createElement("span");j.textContent=d[0].address,S.append(j),c.appendChild(S)}c.appendChild(document.createElement("hr"));var T=document.createElement("div");if(d[0].pricePaid.length>0){var M=document.createElement("strong");for(var B in M.textContent="Prices paid:",T.appendChild(M),d[0].pricePaid){var R=document.createElement("div");R.style="margin-left: 10px;";var q=document.createElement("span");q.textContent=d[0].pricePaid[B].date+" - "+d[0].pricePaid[B].amount,R.appendChild(q),R.appendChild(document.createElement("br")),T.appendChild(R)}c.appendChild(T),c.appendChild(document.createElement("hr"))}var J=document.createElement("div");if(d[0].rights.length>0){var N=document.createElement("strong");for(var k in N.textContent="Rights:",J.appendChild(N),d[0].rights){var w=document.createElement("div");w.style="margin-left: 10px;";var z=document.createElement("strong");z.textContent="Type: ",w.appendChild(z);var A=document.createElement("span");if(A.textContent=d[0].rights[k].type,w.appendChild(A),w.appendChild(document.createElement("br")),d[0].rights[k].description){var H=document.createElement("strong");H.textContent="Description: ",w.appendChild(H);var Y=document.createElement("span");Y.textContent=d[0].rights[k].description,w.appendChild(Y),w.appendChild(document.createElement("br"))}if(d[0].rights[k].endDate&&d[0].rights[k].type.toLowerCase().includes("leasehold")){var V=document.createElement("strong");V.textContent="End date: ",w.appendChild(V);var W=document.createElement("span");W.textContent=d[0].rights[k].endDate,w.appendChild(W),w.appendChild(document.createElement("br"))}var Z=document.createElement("strong");Z.textContent="Party: ",w.appendChild(Z);var G=document.createElement("span");G.textContent=d[0].rights[k].party.name+" ("+d[0].rights[k].party.type+")",w.appendChild(G),w.appendChild(document.createElement("hr")),J.appendChild(w)}c.appendChild(J)}var U=document.createElement("div");if(d[0].restrictions.length>0){var X=document.createElement("strong");for(restriction in X.textContent="Restrictions:",U.appendChild(X),d[0].restrictions){var K=document.createElement("div");K.style="margin-left: 10px;";var Q=document.createElement("strong");Q.textContent="Type: ",K.appendChild(Q);var $=document.createElement("span");if($.textContent=d[0].restrictions[restriction].type,K.appendChild($),K.appendChild(document.createElement("br")),d[0].restrictions[restriction].description){var ee=document.createElement("strong");ee.textContent="Description: ",K.appendChild(ee);var te=document.createElement("span");te.textContent=d[0].restrictions[restriction].description,K.appendChild(te),K.appendChild(document.createElement("br"))}var re=document.createElement("strong");re.textContent="Party: ",K.appendChild(re);var ne=document.createElement("span");ne.textContent=d[0].restrictions[restriction].party.name+" ("+d[0].restrictions[restriction].party.type+")",K.appendChild(ne),K.appendChild(document.createElement("hr")),U.appendChild(K)}c.appendChild(U)}c.style.display="block"}})});for(var d=document.getElementsByName("filter"),l=0;l<d.length;l++)d[l].addEventListener("change",function(e){var t=e.target.value;e.preventDefault(),e.stopPropagation(),s(t)})}});
//# sourceMappingURL=mapbox.js.map